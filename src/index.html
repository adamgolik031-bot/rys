<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🚀 Scraper Results Viewer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-number {
      font-size: 2.5em;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 10px;
    }

    .stat-label {
      font-size: 0.9em;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .controls {
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .file-input {
      margin-bottom: 20px;
    }

    .file-input input {
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 10px;
      width: 100%;
      font-size: 16px;
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background: #f0f0f0;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      width: 0%;
      transition: width 0.3s ease;
    }

    .filters {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-input {
      padding: 10px 15px;
      border: 2px solid #ddd;
      border-radius: 25px;
      font-size: 14px;
      flex: 1;
      min-width: 200px;
    }

    .filter-button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.2s ease;
    }

    .filter-button:hover {
      transform: scale(1.05);
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 25px;
    }

    .result-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .result-card:hover {
      transform: translateY(-10px) scale(1.02);
    }

    .card-header {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 20px;
      position: relative;
    }

    .card-index {
      position: absolute;
      top: 10px;
      right: 15px;
      background: rgba(255, 255, 255, 0.2);
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
    }

    .card-title {
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .card-url {
      font-size: 0.85em;
      opacity: 0.9;
      word-break: break-all;
    }

    .card-body {
      padding: 20px;
    }

    .sources-list {
      margin-top: 15px;
    }

    .source-item {
      background: #f8f9ff;
      padding: 10px;
      margin: 8px 0;
      border-radius: 8px;
      border-left: 4px solid #667eea;
      word-break: break-all;
      font-size: 0.85em;
    }

    .no-sources {
      color: #999;
      font-style: italic;
      text-align: center;
      padding: 20px;
    }

    .timestamp {
      color: #666;
      font-size: 0.8em;
      margin-top: 10px;
    }

    .auto-refresh {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    .toggle-switch {
      position: relative;
      width: 50px;
      height: 25px;
      background: #ccc;
      border-radius: 25px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-switch.active {
      background: #667eea;
    }

    .toggle-switch::after {
      content: "";
      position: absolute;
      top: 2px;
      left: 2px;
      width: 21px;
      height: 21px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }

    .toggle-switch.active::after {
      transform: translateX(25px);
    }

    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-in-progress {
      background: #ffa500;
      animation: pulse 2s infinite;
    }

    .status-completed {
      background: #28a745;
    }

    @keyframes pulse {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }

      100% {
        opacity: 1;
      }
    }

    .loading {
      text-align: center;
      padding: 50px;
      color: #666;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>🚀 Scraper Results Viewer</h1>
      <p>Real-time monitoring of your web scraping progress</p>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="totalItems">0</div>
        <div class="stat-label">Total Items</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="totalPages">0</div>
        <div class="stat-label">Pages Processed</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="cpuCores">12</div>
        <div class="stat-label">CPU Cores Used</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="avgSources">0</div>
        <div class="stat-label">Avg Sources/Item</div>
      </div>
    </div>

    <div class="controls">
      <div class="file-input">
        <input type="file" id="jsonFile" accept=".json" />
      </div>

      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <div class="filters">
        <input type="text" class="filter-input" id="urlFilter" placeholder="🔍 Filter by URL..." />
        <input type="number" class="filter-input" id="pageFilter" placeholder="📄 Page number..."
          style="max-width: 150px" />
        <input type="number" class="filter-input" id="minSources" placeholder="Min sources" style="max-width: 120px" />
        <button class="filter-button" onclick="applyFilters()">
          Apply Filters
        </button>
        <button class="filter-button" onclick="clearFilters()">Clear</button>
      </div>

      <div class="auto-refresh">
        <span>Auto-refresh:</span>
        <div class="toggle-switch" id="autoRefreshToggle" onclick="toggleAutoRefresh()"></div>
        <span id="refreshStatus">OFF</span>
        <span id="statusIndicator">
          <span class="status-indicator status-completed"></span>
          <span id="scrapingStatus">Waiting for data...</span>
        </span>
      </div>
    </div>

    <div id="resultsContainer">
      <div class="loading">
        <div class="spinner"></div>
        <p>Load a JSON file to view scraping results...</p>
      </div>
    </div>
  </div>

  <script>
    let allData = [];
    let filteredData = [];
    let autoRefreshInterval = null;
    let isAutoRefresh = false;

    document
      .getElementById("jsonFile")
      .addEventListener("change", handleFileSelect);

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const jsonData = JSON.parse(e.target.result);
            loadData(jsonData);
          } catch (error) {
            alert("Error parsing JSON file: " + error.message);
          }
        };
        reader.readAsText(file);
      }
    }

    function loadData(jsonData) {
      allData = jsonData.data || [];
      filteredData = [...allData];

      updateStats(jsonData);
      displayResults(filteredData);
      updateScrapingStatus(jsonData.scraping_info?.status || "unknown");
    }

    function updateStats(jsonData) {
      const info = jsonData.scraping_info || {};

      document.getElementById("totalItems").textContent =
        info.total_items_found || info.items_found_so_far || allData.length;
      document.getElementById("totalPages").textContent =
        info.total_pages_processed || info.pages_processed_so_far || 0;
      document.getElementById("cpuCores").textContent =
        info.cpu_cores_used || 12;

      // Calculate average sources
      const totalSources = allData.reduce(
        (sum, item) => sum + (item.sources?.length || 0),
        0,
      );
      const avgSources =
        allData.length > 0 ? (totalSources / allData.length).toFixed(1) : 0;
      document.getElementById("avgSources").textContent = avgSources;

      // Update progress bar
      const progress =
        info.status === "completed"
          ? 100
          : Math.min(95, (info.pages_processed_so_far || 0) * 10);
      document.getElementById("progressFill").style.width = progress + "%";
    }

    function updateScrapingStatus(status) {
      const statusElement = document.getElementById("scrapingStatus");
      const indicatorElement = document.querySelector(
        "#statusIndicator .status-indicator",
      );

      if (status === "in_progress") {
        statusElement.textContent = "Scraping in progress...";
        indicatorElement.className = "status-indicator status-in-progress";
      } else if (status === "completed") {
        statusElement.textContent = "Scraping completed!";
        indicatorElement.className = "status-indicator status-completed";
      } else {
        statusElement.textContent = "Status unknown";
        indicatorElement.className = "status-indicator status-completed";
      }
    }

    function displayResults(data) {
      const container = document.getElementById("resultsContainer");

      if (data.length === 0) {
        container.innerHTML = `
                    <div class="loading">
                        <p>No results match your filters.</p>
                    </div>
                `;
        return;
      }

      const html = data
        .map((item) => {
          const sourcesHtml =
            item.sources && item.sources.length > 0
              ? item.sources
                .map((source) => `<div class="source-item">${source}</div>`)
                .join("")
              : '<div class="no-sources">No video sources found</div>';

          const timestamp = new Date(item.timestamp * 1000).toLocaleString();

          return `
                    <div class="result-card">
                        <div class="card-header">
                            <div class="card-index">Page ${item.page} - #${item.element_index}</div>
                            <div class="card-title">Element ${item.element_index}</div>
                            <div class="card-url">${item.url}</div>
                        </div>
                        <div class="card-body">
                            <div class="sources-list">
                                <strong>Video Sources (${item.sources?.length || 0}):</strong>
                                ${sourcesHtml}
                            </div>
                            <div class="timestamp">🕒 ${timestamp}</div>
                        </div>
                    </div>
                `;
        })
        .join("");

      container.innerHTML = `<div class="results-grid">${html}</div>`;
    }

    function applyFilters() {
      const urlFilter = document
        .getElementById("urlFilter")
        .value.toLowerCase();
      const pageFilter = document.getElementById("pageFilter").value;
      const minSources = document.getElementById("minSources").value;

      filteredData = allData.filter((item) => {
        if (urlFilter && !item.url.toLowerCase().includes(urlFilter))
          return false;
        if (pageFilter && item.page != pageFilter) return false;
        if (minSources && (item.sources?.length || 0) < parseInt(minSources))
          return false;
        return true;
      });

      displayResults(filteredData);
    }

    function clearFilters() {
      document.getElementById("urlFilter").value = "";
      document.getElementById("pageFilter").value = "";
      document.getElementById("minSources").value = "";
      filteredData = [...allData];
      displayResults(filteredData);
    }

    function toggleAutoRefresh() {
      const toggle = document.getElementById("autoRefreshToggle");
      const status = document.getElementById("refreshStatus");

      isAutoRefresh = !isAutoRefresh;

      if (isAutoRefresh) {
        toggle.classList.add("active");
        status.textContent = "ON";
        startAutoRefresh();
      } else {
        toggle.classList.remove("active");
        status.textContent = "OFF";
        stopAutoRefresh();
      }
    }

    function startAutoRefresh() {
      autoRefreshInterval = setInterval(() => {
        const fileInput = document.getElementById("jsonFile");
        if (fileInput.files[0]) {
          handleFileSelect({target: fileInput});
        }
      }, 2000); // Refresh every 2 seconds
    }

    function stopAutoRefresh() {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
      }
    }

    // Keyboard shortcuts
    document.addEventListener("keydown", function (e) {
      if (e.ctrlKey || e.metaKey) {
        if (e.key === "r") {
          e.preventDefault();
          toggleAutoRefresh();
        }
      }
    });
  </script>
</body>

</html>
